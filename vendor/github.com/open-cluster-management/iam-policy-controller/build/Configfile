# Travis build settings
ARCH = $(shell uname -m)
ifeq ($(ARCH), x86_64)
    ARCH = amd64
endif

# Git vars
GIT_COMMIT := $(shell git rev-parse --short HEAD)
GIT_REMOTE_URL := $(shell git config --get remote.origin.url)

# Project settings
APP_NAME ?= iam-policy-controller
VERSION ?= 0.0.1

# Image settings
DOCKER_REGISTRY ?= hyc-cloud-private-scratch-docker-local.artifactory.swg-devops.com
DOCKER_NAMESPACE ?= ibmcom
DOCKER_IMAGE ?= $(APP_NAME)-$(ARCH)
DOCKER_BUILD_TAG ?= $(VERSION)-$(GIT_COMMIT)
DOCKER_BUILD_TAG_RHEL ?= $(DOCKER_BUILD_TAG)-rhel
DOCKER_FILE := Dockerfile
DOCKER_BUILD_DIR := $(TRAVIS_BUILD_DIR)

# Go build settings
GOARCH := $(ARCH)
GOOS := linux

DOCKER_BUILD_OPTS=--build-arg "VCS_REF=$(GIT_COMMIT)" \
	--build-arg "VCS_URL=$(GIT_REMOTE_URL)" \
	--build-arg "IMAGE_NAME=$(DOCKER_IMAGE)" \
	--build-arg "IMAGE_DESCRIPTION=$(IMAGE_DESCRIPTION)" \
	--build-arg "SUMMARY=$(SUMMARY)" \
	--build-arg "GOARCH=$(GOARCH)"